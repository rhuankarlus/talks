#!/bin/bash

# limpando containeres e volumes
docker stop node-under-the-hood-pg
docker rm node-under-the-hood-pg
docker volume rm node-under-the-hood-pg-volume

# limpando diretorios de runtime
rm -rf /$(pwd)/pg/data
rm -rf /$(pwd)/build
rm -rf /$(pwd)/node_modules

# recriando diretorio de dados do postgres
mkdir /$(pwd)/pg/data

# compilando addons e recriando node_modules
node-gyp configure build
yarn

# iniciando postgres
#docker volume create node-under-the-hood-pg-volume
docker run \
    --name node-under-the-hood-pg \
    -v /$(pwd)/pg/data:/var/lib/postgresql/data \
    -v /$(pwd)/pg/scripts:/docker-entrypoint-initdb.d \
    -p 5432:5432 \
    -e POSTGRES_PASSWORD=postgres \
    -d postgres
